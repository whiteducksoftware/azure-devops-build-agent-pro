{
	"$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
	"handler": "Microsoft.Azure.CreateUIDef",
	"version": "0.1.2-preview",
	"parameters": {
		"resourceTypes": [
			"microsoft.resources/resourcegroups"
		],
		"basics": [
			{
				"name": "resourcesConfig",
				"type": "Microsoft.Common.Section",
				"label": "Resources configuration",
				"elements": [
					{
						"name": "vmssName",
						"type": "Microsoft.Common.TextBox",
						"label": "VM Scale set name",
						"toolTip": "String used as a base for naming resources (9 characters or less). A hash is prepended to this string for some resources, and resource-specific information is appended.",
						"constraints": {
							"required": true,
							"regex": "^[a-z][a-zA-Z0-9_-]{1,7}[a-zA-Z0-9_-]$",
							"validationMessage": "The value should have 9 or less characters. It must contain only letters and numbers."
						},
						"visible": true
					}
				]
			},
			{
				"name": "vmCredentials",
				"type": "Microsoft.Common.Section",
				"label": "VM credentials",
				"elements": [
					{
						"name": "adminUsername",
						"type": "Microsoft.Common.TextBox",
						"label": "Username",
						"defaultValue": "",
						"toolTip": "Admin username on all VMs.",
						"constraints": {
							"required": true,
							"regex": "^[a-z0-9A-Z]{1,30}$",
							"validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
						},
						"osPlatform": "Linux",
						"visible": true
					},
					{
						"name": "adminPassword",
						"type": "Microsoft.Common.PasswordBox",
						"label": {
							"password": "Password",
							"confirmPassword": "Confirm password"
						},
						"toolTip": "Password for the Virtual Machine.",
						"constraints": {
							"required": true,
							"regex": "^(?=.*[A-Za-z])(?=.*\\d)(?=.*[$@$!%*#?&])[A-Za-z\\d$@$!%*#?&]{8,}$",
							"validationMessage": "Passwords must be at least 8 characters long, contain a letter, a number, and a special character"
						},
						"options": {
							"hideConfirmation": false
						},
						"visible": true
					}
				],
				"visible": true
			}
		],
		"steps": [
			{
				"name": "vmSettings",
				"label": "VM + Network settings",
				"subLabel": {
					"preValidation": "Chose a VM Size. We strongly recommend to Premium SSD.",
					"postValidation": "Done"
				},
				"bladeTitle": "VM + Network settings",
				"elements": [
					{
						"name": "vmSize",
						"type": "Microsoft.Compute.SizeSelector",
						"label": "VM Size",
						"toolTip": "Select a size for your VM",
						"recommendedSizes": [
							"Standard_DS2_v2"
						],
						"options": {
							"hideDiskTypeFilter": false
						},
						"osPlatform": "Linux",
						"imageReference": {
							"publisher": "Canonical",
							"offer": "UbuntuServer",
							"sku": "[basics('Linux_OS_Version')]"
						},
						"count": 0,
						"visible": true
					},
					{
						"name": "osDiskType",
						"type": "Microsoft.Common.DropDown",
						"label": "OS Disk type",
						"defaultValue": "Standard_LRS",
						"toolTip": "Type of disk to use",
						"constraints": {
							"allowedValues": [
								{
									"label": "Standard HDD",
									"value": "Standard_LRS"
								},
								{
									"label": "Standard SSD",
									"value": "Premium_LRS"
								},
								{
									"label": "Premium SSD",
									"value": "StandardSSD_LRS"
								}
							],
							"required": true
						},
						"visible": true
					},
					{
						"name": "vnetIP",
						"type": "Microsoft.Common.TextBox",
						"label": "Virtual network IP address",
						"defaultValue": "192.168.0.0/24",
						"toolTip": "Network IP address range in CIDR notation",
						"constraints": {
        					"required": true,
        					"validations": [
            					{
                					"regex": "^(?:[0-9]{1,3}.){3}[0-9]{1,3}\/[0-9]{2}$",
                					"message": "not a valid IP address. E.g. 192.168.0.0/24"
            					}
        					]
    					},
						"visible": true
					},
					{
						"name": "subnetIP",
						"type": "Microsoft.Common.TextBox",
						"label": "Subnet IP address",
						"defaultValue": "192.168.0.0/24",
						"toolTip": "Subnet IP address range in CIDR notation",
						"constraints": {
        					"required": true,
        					"validations": [
            					{
                					"regex": "^(?:[0-9]{1,3}.){3}[0-9]{1,3}\/[0-9]{2}$",
                					"message": "not a valid IP address. E.g. 192.168.0.0/24"
            					}
        					]
    					},
						"visible": true
					}
				]
			}
		],
		"outputs": {
			"location": "[location()]",
			"vmssName": "[basics('resourcesConfig').vmssName]",
			"instanceSize": "[steps('vmSettings').vmSize]",
			"osDiskType": "[steps('vmSettings').osDiskType]",
			"adminUsername": "[basics('vmCredentials').adminUsername]",
			"adminPassword": "[basics('vmCredentials').adminPassword]",
			"addressPrefix": "[steps('vmSettings').vnetIP]",
			"subnetPrefix": "[steps('vmSettings').subnetIP]"
		}
	}
}